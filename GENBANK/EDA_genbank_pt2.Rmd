---
title: "EDA_genbank_part2"
author: "Lorena Malpica"
date: "17 de julio de 2018"
output:
  html_document: default
  pdf_document: default
---

```{r, echo=F, warning=F, message=F}
#Ahora se filtrarán organismos modelo.
library(dplyr)
library(ggplot2)
library(readr)
genbank<-read_delim("./GENBANK_data_ph.csv", delim = "|")

model_org<-c('Ashbya gossypii', 'Aspergillus nidulans', 'Coprinus cinereus', 'Cryptococcus neoformans', 'Neurospora crassa', 'Saccharomyces cerevisiae', 'Schizophyllum commune', 'Schizosaccharomyces pombe', 'Arabidopsis thaliana', 'Selaginella moellendorffii', 'Brachypodium distachyon', 'Setaria viridis', 'Lotus japonicus', 'Lemna gibba', 'Medicago truncatula', 'Erythranthe guttata', 'Mimulus guttatus', 'Nicotiana benthamiana', 'Oryza sativa', 'Physcomitrella patens', 'Marchantia polymorpha', 'Amphimedon queenslandica',  'Aplysia cornigera', 'Aplysia fasciata', 'Caenorhabditis elegans', 'Drosophila melanogaster',  'Euprymna scolopes', 'Macrostomum lignano', 'Pristionchus pacificus', 'Scathophaga stercoraria', 'Schmidtea mediterranea', 'Felis sylvestris catus', 'Canis lupus familiaris', 'Mesocricetus auratus', 'Cavia porcellus', 'Oryzias latipes', 'Mus musculus', 'Heterocephalus glaber', 'Columba livia domestica', 'Rattus norvegicus', 'Rhesus macaque', 'Xenopus laevis', 'Xenopus tropicalis', 'Danio rerio', 'Taeniopygia guttata', 'Homo sapiens')
genbank_original<-genbank
genbank<-genbank[-(which(!(is.na(match(genbank$Species_name, model_org))))),]

```



```{r, echo=F, warning=F, message=F}
metazoa<-genbank%>%filter(kingdom=="Metazoa")
plant<-genbank%>%filter(kingdom=="Viridiplantae")
fungi<-genbank%>%filter(kingdom=="Fungi")

```




```{r, echo=F, warning=F, message=F}
#Checar que son los que tienen NA en clase del phylum chordata. 
chordata<-metazoa[which(metazoa$phylum=="Chordata"),]
chordata_na<-chordata[which(is.na(chordata$class)),]
chordna_order<-chordata_na %>% group_by(order) %>% summarise (n())
colnames(chordna_order)<- c("Order", "Num_seqs")
chordna_order_plot<-ggplot(data=chordna_order) + aes(x=Order, y=Num_seqs, fill=Order) +
                 geom_bar(stat="identity")+theme(axis.text.x=element_text(angle=90)) + ggtitle("Num. de secuencias por orden para los NA de Chordata")
```

```{r, echo=F, warning=F, message=F}
chordna_order
chordna_order_plot
```


Crocodylia: Reptilia

Petromyzontiformes: 	Hyperoartia

Squamata: 	Sauropsida

Testudines: Reptilia


Agrego las clases a mano en el data frame genbank y vuelvo a sacar el df metazoa

```{r, echo=F, warning=F, message=F}
genbank[which(genbank$order=="Crocodylia"), 22]<-"Reptilia"
genbank[which(genbank$order=="Petromyzontiformes"), 22]<-"Hyperoartia"
genbank[which(genbank$order=="Squamata"), 22]<-"Sauropsida"
genbank[which(genbank$order=="Testudines"), 22]<-"Reptilia"

metazoa<-genbank%>%filter(kingdom=="Metazoa")
```

```{r, echo=F, warning=F, message=F}
met_class<-metazoa%>% group_by(phylum, class) %>% summarise(n())
colnames(met_class)<- c("Phylum", "Class", "Num_seqs")


pla_class<-plant%>%group_by(phyl_bold, class_bold) %>% summarise(n())
colnames(pla_class)<-c("Phylum", "Class", "Num_seqs")


fun_class<-fungi%>%group_by(phylum, class) %>% summarise (n())
colnames(fun_class)<-c("Phylum", "Class", "Num_seqs")
```


Plots por clase:
```{r, echo=F, warning=F, message=F}
clas_met_plot<-ggplot(data=met_class)+ aes(x=Class, y=Num_seqs, fill=Class) +
                 geom_bar(stat="identity")+theme(axis.text.x=element_text(angle=90)) + ggtitle("Num. de secuencias por clase en Metazoa")
clas_pla_plot<-ggplot(data=pla_class)+ aes(x=Class, y=Num_seqs, fill=Class) +
                 geom_bar(stat="identity")+theme(axis.text.x=element_text(angle=90)) + ggtitle("Num. de secuencias por clase en Viridiplantae")
clas_fun_plot<-ggplot(data=fun_class)+ aes(x=Class, y=Num_seqs, fill=Class) +
                 geom_bar(stat="identity")+theme(axis.text.x=element_text(angle=90)) + ggtitle("Num. de secuencias por clase en Fungi")
```


```{r, echo=F, warning=F, message=F}
clas_met_plot
clas_pla_plot
clas_fun_plot
```


```{r, echo=F, warning=F, message=F}
total<-nrow(genbank)
latlon_info<-nrow(genbank[genbank$latlon_info==T,])
estado_info<-nrow(genbank[-(which(is.na(genbank$estado))),])
region_info<-nrow(genbank[-(which(is.na(genbank$region))),])
geo_info<-rbind(total, latlon_info, estado_info, region_info)
geo_info<-cbind(c("Total", "Info. Coordenadas", "Info. estado", "Info. region"), geo_info)
colnames(geo_info)<-c("Informacion", "Num_seqs")
geo_info<-as.data.frame(geo_info)
geo_info$Num_seqs<-as.numeric(geo_info$Num_seqs)
geo_info$Num_seqs<-c(total, latlon_info, estado_info, region_info)
geo_info_plot<-ggplot(data=geo_info)+ aes(x=Informacion, y=Num_seqs, fill=Informacion) +
                 geom_bar(stat="identity")+theme(axis.text.x=element_text(angle=90)) + ggtitle("Informacion geográfica disponible")
geo_info_plot
```


```{r, echo=F, warning=F, message=F}
clas_art_plot<-ggplot(data=met_class[which(met_class$Phylum=="Arthropoda"),])+ aes(x=Class, y=Num_seqs, fill=Class) + geom_bar(stat="identity")+theme(axis.text.x=element_text(angle=90)) + ggtitle("Num. de secuencias por clase en Arthropoda")
clas_chor_plot<-ggplot(data=met_class[which(met_class$Phylum=="Chordata"),])+ aes(x=Class, y=Num_seqs, fill=Class) + geom_bar(stat="identity")+theme(axis.text.x=element_text(angle=90)) + ggtitle("Num. de secuencias por clase en Chordata")
clas_asc_plot<-ggplot(data=fun_class[which(fun_class$Phylum=="Ascomycota"),]) + aes(x=Class, y=Num_seqs, fill=Class) +
                 geom_bar(stat="identity")+theme(axis.text.x=element_text(angle=90)) + ggtitle("Num. de secuencias por clase en Ascomycota")
clas_bas_plot<-ggplot(data=fun_class[which(fun_class$Phylum=="Basidiomycota"),]) + aes(x=Class, y=Num_seqs, fill=Class) +
                 geom_bar(stat="identity")+theme(axis.text.x=element_text(angle=90)) + ggtitle("Num. de secuencias por clase en Basidiomycota")
```


Gráficas de secuencias por clase para cada phylum seleccionado en metazoa y fungi. 

```{r, echo=F, warning=F, message=F}
clas_art_plot
clas_chor_plot
clas_asc_plot
clas_bas_plot

```


```{r, echo=F, warning=F, message=F}
write_delim(genbank, "GENBANK_data_m.csv", delim = "|")
```

Aquí ya solo se está trabajando con los phylum escogidos para cada reino. 
```{r, echo=F, warning=F, message=F}
library(dplyr)
library(ggplot2)
library(readr)
library(magrittr)

genbank<-read_delim("./GENBANK_data_m.csv", delim = "|")


```

Marcadores GENBANK


Markers dictionary.

Unificar los marcadores de genbank.

```{r, echo=F, warning=F, message=F}
library(tidyr)
library(stringr)
#quitar el nombre de la especie de la definición para tener la lista de definiciones únicas más corta
genbank_1<-mutate(genbank, definition_1=str_replace(definition, source_organism, " "))

```

```{r, echo=F, warning=F, message=F}
#Quitar la primera parte que muchas veces es la cepa o el lugar genomico del fragmento de genoma del que se trata 
#Intentar quitar cepas vouchers etc de la definicion.
#work in progress...


definition_1<-genbank_1$definition_1


definition_1_1<-str_replace_all(definition_1, "_|\\:|#|/|\\*", "")
definition_1_1<-str_replace_all(definition_1_1, ".+ ipomoeae|.+ apicola|Cryptococcus gattii|Chaunopycnis pustulata|KM1|<CAN>|araneetroplus synspilus |araneetroplus fenestratus |tesimogastroides sp|enkinsia|.+ glabrata|MITS|(in Fungi)|Hexagonia sp|San Luis Potosi|from|TYPE material|\\(\\)|Mammilloydia candida|culture|Micos River|Chica cave|Pachon cave|Oligotrofic mesocosms in Cuatro Cienegas, Mexico|isolationsource|var albidus|Soto|et al|&|E Martinez|and|Estrada|Huerta|Figueroa|Salazar|Reyes|Castillejos|Suarez|Tenorio sn|Kroemer|-collection|Collection of Phytopathogenic FungiUACH|Antrodia malicola","")
definition_1_1<-str_replace(definition_1_1, ".?Candida.?[:blank:][:alnum:]+|Uncultured[:blank:][:alnum:]+|.?Cryptococcus.?[:blank:][:alnum:]+|Und[:blank:]+[:alnum:]+|.?Cryptochelys.?[:blank:][:alnum:]+|.?Cida.?[:blank:][:alnum:]+", "")
definition_1_1<-str_replace(definition_1_1, "scaffold([0-9]+)|Scaffold([0-9]+),", "")
definition_1_1<-str_replace(definition_1_1, "scaffold_([0-9]+), ", "")
definition_1_1<-str_replace(definition_1_1, " ASM165401v1, | ASM165402v1, ", "")
definition_1_1<-str_replace(definition_1_1, "voucher[:blank:]([:alnum:]|-)+", "")
definition_1_1<-str_replace(definition_1_1, "isolate[:blank:]([:alnum:]|-)+", "")
definition_1_1<-str_replace(definition_1_1, "str[:blank:]([:alnum:]|-)+", "")
definition_1_1<-str_replace(definition_1_1, "strain[:blank:]([:alnum:]|-)+", "")
definition_1_1<-str_replace(definition_1_1, "clone[:blank:]([:alnum:]|-)+", "")
definition_1_1<-str_replace(definition_1_1, "clone clone[:blank:]([:alnum:]|-)+", "")
#Quitar espacio y coma iniciales asi como ids alfanumericos(esto se hace recursivamente porque puede que a la primera no se alcance a quitar todos los ids si estan separados por muchos espacios, y ademas queremos evitar quitar info importante. )
definition_1_1<-str_replace(definition_1_1, "ep add|ain|[:blank:]aff[:blank:]|fallax", "")
definition_1_1<-trimws(definition_1_1, which = c("both"))
definition_1_1<-str_replace(definition_1_1, "^([:digit:]|\\.)+[:blank:]", "")
definition_1_1<-trimws(definition_1_1, which = c("both"))
#definition_1_1<-str_replace(definition_1_1, "^[:upper:]+[:digit:]+[:upper:]*", "")
definition_1_1<-trimws(definition_1_1, which = c("both"))
definition_1_1<-str_replace(definition_1_1, "^[:digit:]+[:blank:]", "")
definition_1_1<-trimws(definition_1_1, which = c("both"))
#definition_1_1<-str_replace(definition_1_1, "^[:upper:]+[:digit:]+[:upper:]*", "")
definition_1_1<-trimws(definition_1_1, which = c("both"))
definition_1_1<-str_replace(definition_1_1, "^,", "")

definition_1_1<-str_replace(definition_1_1, "^ep", "")
#definition_1_1<-str_replace(definition_1_1, "^[:digit:]{3,}|^[:upper:] ", "")
definition_1_1<-str_replace(definition_1_1, "[:digit:]{3,}", "")
#definition_1_1<-str_replace(definition_1_1, "^[:upper:]+[:digit:]+[:upper:]*", "")
definition_1_1<-str_replace(definition_1_1, ".*cytochrome", "cytochrome")
#definition_1_1<-str_replace(definition_1_1, "^[:alpha:]+[:digit:]+[:alpha:]*", "")
definition_1_1<-trimws(definition_1_1, which = c("both"))
#definition_1_1<-str_replace(definition_1_1, "^[:blank:]*[:digit:]+[:blank:]+", "")

definition_1_1<-trimws(definition_1_1, which = c("both"))

definition_1_1<-trimws(definition_1_1, which = c("both"))
definition_1_1<-str_replace(definition_1_1, "[:blank:]*[:digit:]+[:blank:]+", "")
#definition_1_1<-str_replace(definition_1_1, "[:digit:]{3,}", "")
definition_1_1<-str_replace(definition_1_1, "personalCulture|Collection of Phytopathogenic FungiUACH|personalJosHoubrakenDTO.*[:blank:]+", "")


definition_1_2<-unique(definition_1_1)

View(as.data.frame(definition_1_2))
View(as.data.frame(definition_1_1))
View(as.data.frame(definition_1))

#este es el  de unique 41791 y la columna de definition_1 es unique 200,000 y cacho (solo quitando los nombres de especies)
genbank_1$definition_2<-definition_1_1

```



Extraer los genes que nos interesan.


```{r, echo=F, warning=F, message=F}
fungi_genbank<-genbank_1[genbank$kingdom=="Fungi",]
metazoa_genbank<-genbank_1[genbank$kingdom=="Metazoa",]
plantae_genbank<-genbank_1[genbank$kingdom=="Viridiplantae",]

fungi_markersg<-unique(fungi_genbank$definition_2)
metazoa_markersg<-unique(metazoa_genbank$definition_2)
plantae_markersg<-unique(plantae_genbank$definition_2)

fungi_geo_markers<-fungi_genbank[,c(1,2,7,8,12:14,27:30,37,38)]
metazoa_geo_markers<-metazoa_genbank[,c(1,2,7,8,12:14,27:30,37,38)]
plantae_geo_markers<-plantae_genbank[,c(1,2,7,8,12:14,27:30,37,38)]

fungi_geo_markers$markers<-NA
metazoa_geo_markers$markers<-NA
plantae_geo_markers$markers<-NA

#fungi
fungi_geo_markers[which(grepl(" ITS([[:blank:]]|,)|internal transcribed spacer([[:blank:]]|,)", fungi_geo_markers$definition)),14]<-"ITS"
                  
fungi_geo_markers[which(grepl("ITS[:blank:]1|internal transcribed spacer 1| ITS1", fungi_geo_markers$definition)),14]<-"ITS1"


fungi_geo_markers[which(grepl("ITS[:blank:]2|internal transcribed spacer 2| ITS2", fungi_geo_markers$definition)),14]<-with(fungi_geo_markers[which(grepl("ITS[:blank:]2|internal transcribed spacer 2| ITS2", fungi_geo_markers$definition)),], paste(markers, "ITS2", sep=","))

#metazoa
metazoa_geo_markers[which(grepl("CYTB|cytochrome b,)", metazoa_geo_markers$definition)),14]<-"CYTB"

metazoa_geo_markers[which(grepl("COI|cytochrome oxidase subunit (1|I)([[:blank:]]|,)", metazoa_geo_markers$definition)),14]<-"COI"

metazoa_geo_markers[which(grepl("COII|cytochrome oxidase subunit (2|II)([[:blank:]]|,)", metazoa_geo_markers$definition)),14]<-"COII"


metazoa_geo_markers[which(grepl("COX1|COXI([[:blank:]]|\\)|,)|cytochrome c oxidase subunit (1|I)([[:blank:]]|,)", metazoa_geo_markers$definition)),14]<-"COX1"

metazoa_geo_markers[which(grepl("COX2|COXII([[:blank:]]|\\)|,)|cytochrome c oxidase subunit (2|II)([[:blank:]]|,)", metazoa_geo_markers$definition)),14]<-with(metazoa_geo_markers[which(grepl("COX2|COXII([[:blank:]]|\\)|,)|cytochrome c oxidase subunit (2|II)([[:blank:]]|,)", metazoa_geo_markers$definition)),], paste(markers, "COX2", sep=","))

#Plants
plantae_geo_markers[which(grepl("chloroplast|cpDNA", plantae_geo_markers$definition)),14]<-"chloroplast"

plantae_geo_markers[which(grepl("accD", plantae_geo_markers$definition)),14]<-with(plantae_geo_markers[which(grepl("accD", plantae_geo_markers$definition)),], paste(markers, "accD", sep=","))

plantae_geo_markers[which(grepl("atp(A|B|E|F|H|I|l)", plantae_geo_markers$definition)), 14]<-with(plantae_geo_markers[which(grepl("atp(A|B|E|F|H|I|l)", plantae_geo_markers$definition)),], paste(markers, "atp_genes", sep=","))


plantae_geo_markers[which(grepl("ccsA", plantae_geo_markers$definition)), 14]<-with(plantae_geo_markers[which(grepl("ccsA", plantae_geo_markers$definition)),], paste(markers, "ccsA", sep=","))

plantae_geo_markers[which(grepl("cemA", plantae_geo_markers$definition)), 14]<-with(plantae_geo_markers[which(grepl("cemA", plantae_geo_markers$definition)),], paste(markers, "cemA", sep=","))

plantae_geo_markers[which(grepl("clpP", plantae_geo_markers$definition)), 14]<-with(plantae_geo_markers[which(grepl("clpP", plantae_geo_markers$definition)),], paste(markers, "clpP", sep=","))

plantae_geo_markers[which(grepl("matK", plantae_geo_markers$definition)), 14]<-with(plantae_geo_markers[which(grepl("matK", plantae_geo_markers$definition)),], paste(markers, "matK", sep=","))

plantae_geo_markers[which(grepl("ndh(A|B|C|D|E|F|G|H|I|J|l|K)", plantae_geo_markers$definition)), 14]<-with(plantae_geo_markers[which(grepl("ndh(A|B|C|D|E|F|G|H|I|J|l|K)", plantae_geo_markers$definition)),], paste(markers, "ndh_genes", sep=","))



plantae_geo_markers[which(grepl("psb(A|B|C|D|E|F|H|I|J|K|l|L|M|N|T|Z)", plantae_geo_markers$definition)), 14]<-with(plantae_geo_markers[which(grepl("psb(A|B|C|D|E|F|H|I|J|K|l|L|M|N|T|Z)", plantae_geo_markers$definition)),], paste(markers, "psb_genes", sep=","))


plantae_geo_markers[which(grepl("rbcL", plantae_geo_markers$definition)), 14]<-with(plantae_geo_markers[which(grepl("rbcL", plantae_geo_markers$definition)),], paste(markers, "rbcL", sep=","))


plantae_geo_markers[which(grepl("rpI(2|14|16|20|23|32|33|36)", plantae_geo_markers$definition)), 14]<-with(plantae_geo_markers[which(grepl("rpI(2|14|16|20|23|32|33|36)", plantae_geo_markers$definition)),], paste(markers, "rpI_genes", sep=","))

plantae_geo_markers[which(grepl("rpl(2|14|16|20|23|32|33|36)", plantae_geo_markers$definition)), 14]<-with(plantae_geo_markers[which(grepl("rpl(2|14|16|20|23|32|33|36)", plantae_geo_markers$definition)),], paste(markers, "rpl_genes", sep=","))

plantae_geo_markers[which(grepl("rpo(A|B|C|C1|C2)", plantae_geo_markers$definition)), 14]<-with(plantae_geo_markers[which(grepl("rpo(A|B|C|C1|C2)", plantae_geo_markers$definition)),], paste(markers, "rpo_genes", sep=","))
                                                                                                                     
plantae_geo_markers[which(grepl("rps(2|3|4|7|8|11|12|14|15|16|18|19)", plantae_geo_markers$definition)), 14]<-with(plantae_geo_markers[which(grepl("rps(2|3|4|7|8|11|12|14|15|16|18|19)", plantae_geo_markers$definition)),], paste(markers, "rps_genes", sep=","))

plantae_geo_markers[which(grepl("rrn(4|4.5|5|16|23)", plantae_geo_markers$definition)), 14]<-with(plantae_geo_markers[which(grepl("rrn(4|4.5|5|16|23)", plantae_geo_markers$definition)),], paste(markers, "rrn_genes", sep=","))
     
plantae_geo_markers[which(grepl("trn(A|C|D|E|F|fM|G|H|I|K|L|l|M|N|P|Q|R|S|T|V|W|Y)", plantae_geo_markers$definition)), 14]<-with(plantae_geo_markers[which(grepl("trn(A|C|D|E|F|fM|G|H|I|K|L|l|M|N|P|Q|R|S|T|V|W|Y)", plantae_geo_markers$definition)),], paste(markers, "trn_genes", sep=","))
  
plantae_geo_markers[which(grepl("ycf(1|2|3)", plantae_geo_markers$definition)), 14]<-with(plantae_geo_markers[which(grepl("ycf(1|2|3)", plantae_geo_markers$definition)),], paste(markers, "ycf_genes", sep=","))

plantae_geo_markers$markers<-gsub("^NA,", "", plantae_geo_markers$markers)
fungi_geo_markers$markers<-gsub("^NA,", "", fungi_geo_markers$markers)
metazoa_geo_markers$markers<-gsub("^NA", "", metazoa_geo_markers$markers)
 
                                                                                                                
```

GRAFICAS GENBANK DE INFO GEOGRAFICA POR MARCADORES 
GENBANK
```{r, echo=F, warning=F, message=F}
plantae_geo_markers$country_info<-NA
plantae_geo_markers$estado_info<-NA
plantae_geo_markers$region_info<-NA

plantae_geo_markers[which(is.na(plantae_geo_markers$country)==T),15]<-FALSE
plantae_geo_markers[which(is.na(plantae_geo_markers$country)==F),15]<-TRUE


plantae_geo_markers[which(is.na(plantae_geo_markers$estado)==T),16]<-FALSE
plantae_geo_markers[which(is.na(plantae_geo_markers$estado)==F),16]<-TRUE

plantae_geo_markers[which(is.na(plantae_geo_markers$region)==T),17]<-FALSE
plantae_geo_markers[which(is.na(plantae_geo_markers$region)==F),17]<-TRUE


fungi_geo_markers$country_info<-NA
fungi_geo_markers$estado_info<-NA
fungi_geo_markers$region_info<-NA

fungi_geo_markers[which(is.na(fungi_geo_markers$country)==T),15]<-FALSE
fungi_geo_markers[which(is.na(fungi_geo_markers$country)==F),15]<-TRUE


fungi_geo_markers[which(is.na(fungi_geo_markers$estado)==T),16]<-FALSE
fungi_geo_markers[which(is.na(fungi_geo_markers$estado)==F),16]<-TRUE

fungi_geo_markers[which(is.na(fungi_geo_markers$region)==T),17]<-FALSE
fungi_geo_markers[which(is.na(fungi_geo_markers$region)==F),17]<-TRUE



metazoa_geo_markers$country_info<-NA
metazoa_geo_markers$estado_info<-NA
metazoa_geo_markers$region_info<-NA

metazoa_geo_markers[which(is.na(metazoa_geo_markers$country)==T),15]<-FALSE
metazoa_geo_markers[which(is.na(metazoa_geo_markers$country)==F),15]<-TRUE


metazoa_geo_markers[which(is.na(metazoa_geo_markers$estado)==T),16]<-FALSE
metazoa_geo_markers[which(is.na(metazoa_geo_markers$estado)==F),16]<-TRUE

metazoa_geo_markers[which(is.na(metazoa_geo_markers$region)==T),17]<-FALSE
metazoa_geo_markers[which(is.na(metazoa_geo_markers$region)==F),17]<-TRUE

#latlon
p_markers_latlon<-plantae_geo_markers%>%group_by(markers, latlon_info)%>%summarise(n())
colnames(p_markers_latlon)<-c("markers", "latlon_info", "Num_seqs")

p_latlon_plot1<-ggplot(p_markers_latlon[1:19,], aes(factor(markers), Num_seqs, fill=latlon_info)) +
 geom_bar(stat="identity", position = "dodge") + 
  scale_fill_brewer(palette = "Set1") + ggtitle("Datos con/sin coordinadas por marcadores plantae 1")  + theme(axis.text.x = element_text(angle = 90, hjust = 1))

p_latlon_plot2<-ggplot(p_markers_latlon[19:38,], aes(factor(markers), Num_seqs, fill=latlon_info)) +
 geom_bar(stat="identity", position = "dodge") + 
  scale_fill_brewer(palette = "Set1") + ggtitle("Datos con/sin coordinadas por marcadores plantae 2")  + theme(axis.text.x = element_text(angle = 90, hjust = 1))
p_latlon_plot3<-ggplot(p_markers_latlon[39:58,], aes(factor(markers), Num_seqs, fill=latlon_info)) +
 geom_bar(stat="identity", position = "dodge") + 
  scale_fill_brewer(palette = "Set1") + ggtitle("Datos con/sin coordinadas por marcadores plantae 3")  + theme(axis.text.x = element_text(angle = 90, hjust = 1))
p_latlon_plot4<-ggplot(p_markers_latlon[59:76,], aes(factor(markers), Num_seqs, fill=latlon_info)) +
 geom_bar(stat="identity", position = "dodge") + 
  scale_fill_brewer(palette = "Set1") + ggtitle("Datos con/sin coordinadas por marcadores plantae 4") + theme(axis.text.x = element_text(angle = 90, hjust = 1))


m_markers_latlon<-metazoa_geo_markers%>%group_by(markers, latlon_info)%>%summarise(n())
colnames(m_markers_latlon)<-c("markers", "latlon_info", "Num_seqs")

m_latlon_plot<-ggplot(m_markers_latlon, aes(factor(markers), Num_seqs, fill=latlon_info)) +
 geom_bar(stat="identity", position = "dodge") + 
  scale_fill_brewer(palette = "Set1") + ggtitle("Datos con/sin coordinadas por marcadores Metazoa")  + theme(axis.text.x = element_text(angle = 90, hjust = 1))


f_markers_latlon<-fungi_geo_markers%>%group_by(markers, latlon_info)%>%summarise(n())
colnames(f_markers_latlon)<-c("markers", "latlon_info", "Num_seqs")

f_latlon_plot<-ggplot(f_markers_latlon, aes(factor(markers), Num_seqs, fill=latlon_info)) +
 geom_bar(stat="identity", position = "dodge") + 
  scale_fill_brewer(palette = "Set1") + ggtitle("Datos con/sin coordinadas por marcadores Fungi")  + theme(axis.text.x = element_text(angle = 90, hjust = 1))

#estado
p_markers_estado<-plantae_geo_markers%>%group_by(markers, estado_info)%>%summarise(n())
colnames(p_markers_estado)<-c("markers", "estado_info", "Num_seqs")

p_estado_plot1<-ggplot(p_markers_estado[1:19,], aes(factor(markers), Num_seqs, fill=estado_info)) +
 geom_bar(stat="identity", position = "dodge") + 
  scale_fill_brewer(palette = "Set1") + ggtitle("Datos con/sin estado por marcadores plantae 1")  + theme(axis.text.x = element_text(angle = 90, hjust = 1))

p_estado_plot2<-ggplot(p_markers_estado[19:38,], aes(factor(markers), Num_seqs, fill=estado_info)) +
 geom_bar(stat="identity", position = "dodge") + 
  scale_fill_brewer(palette = "Set1") + ggtitle("Datos con/sin estado por marcadores plantae 2")  + theme(axis.text.x = element_text(angle = 90, hjust = 1))
p_estado_plot3<-ggplot(p_markers_estado[39:58,], aes(factor(markers), Num_seqs, fill=estado_info)) +
 geom_bar(stat="identity", position = "dodge") + 
  scale_fill_brewer(palette = "Set1") + ggtitle("Datos con/sin estado por estado plantae 3")  + theme(axis.text.x = element_text(angle = 90, hjust = 1))
p_estado_plot4<-ggplot(p_markers_estado[59:76,], aes(factor(markers), Num_seqs, fill=estado_info)) +
 geom_bar(stat="identity", position = "dodge") + 
  scale_fill_brewer(palette = "Set1") + ggtitle("Datos con/sin estado por marcadores plantae 4") + theme(axis.text.x = element_text(angle = 90, hjust = 1))


m_markers_estado<-metazoa_geo_markers%>%group_by(markers, estado_info)%>%summarise(n())
colnames(m_markers_estado)<-c("markers", "estado_info", "Num_seqs")

m_estado_plot<-ggplot(m_markers_estado, aes(factor(markers), Num_seqs, fill=estado_info)) +
 geom_bar(stat="identity", position = "dodge") + 
  scale_fill_brewer(palette = "Set1") + ggtitle("Datos con/sin estado por marcadores Metazoa")  + theme(axis.text.x = element_text(angle = 90, hjust = 1))


f_markers_estado<-fungi_geo_markers%>%group_by(markers, estado_info)%>%summarise(n())
colnames(f_markers_estado)<-c("markers", "estado_info", "Num_seqs")

f_estado_plot<-ggplot(f_markers_estado, aes(factor(markers), Num_seqs, fill=estado_info)) +
 geom_bar(stat="identity", position = "dodge") + 
  scale_fill_brewer(palette = "Set1") + ggtitle("Datos con/sin estado por marcadores Fungi")  + theme(axis.text.x = element_text(angle = 90, hjust = 1))



#region
p_markers_region<-plantae_geo_markers%>%group_by(markers, region_info)%>%summarise(n())
colnames(p_markers_region)<-c("markers", "region_info", "Num_seqs")

p_region_plot1<-ggplot(p_markers_region[1:19,], aes(factor(markers), Num_seqs, fill=region_info)) +
 geom_bar(stat="identity", position = "dodge") + 
  scale_fill_brewer(palette = "Set1") + ggtitle("Datos con/sin region por marcadores plantae 1")  + theme(axis.text.x = element_text(angle = 90, hjust = 1))

p_region_plot2<-ggplot(p_markers_region[19:38,], aes(factor(markers), Num_seqs, fill=region_info)) +
 geom_bar(stat="identity", position = "dodge") + 
  scale_fill_brewer(palette = "Set1") + ggtitle("Datos con/sin region por marcadores plantae 2")  + theme(axis.text.x = element_text(angle = 90, hjust = 1))
p_region_plot3<-ggplot(p_markers_region[39:58,], aes(factor(markers), Num_seqs, fill=region_info)) +
 geom_bar(stat="identity", position = "dodge") + 
  scale_fill_brewer(palette = "Set1") + ggtitle("Datos con/sin region por estado plantae 3")  + theme(axis.text.x = element_text(angle = 90, hjust = 1))
p_region_plot4<-ggplot(p_markers_region[59:76,], aes(factor(markers), Num_seqs, fill=region_info)) +
 geom_bar(stat="identity", position = "dodge") + 
  scale_fill_brewer(palette = "Set1") + ggtitle("Datos con/sin region por marcadores plantae 4") + theme(axis.text.x = element_text(angle = 90, hjust = 1))





m_markers_region<-metazoa_geo_markers%>%group_by(markers, region_info)%>%summarise(n())
colnames(m_markers_region)<-c("markers", "region_info", "Num_seqs")

m_region_plot<-ggplot(m_markers_region, aes(factor(markers), Num_seqs, fill=region_info)) +
 geom_bar(stat="identity", position = "dodge") + 
  scale_fill_brewer(palette = "Set1") + ggtitle("Datos con/sin region por marcadores Metazoa")  + theme(axis.text.x = element_text(angle = 90, hjust = 1))


f_markers_region<-fungi_geo_markers%>%group_by(markers, region_info)%>%summarise(n())
colnames(f_markers_region)<-c("markers", "region_info", "Num_seqs")

f_region_plot<-ggplot(f_markers_region, aes(factor(markers), Num_seqs, fill=region_info)) +
 geom_bar(stat="identity", position = "dodge") + 
  scale_fill_brewer(palette = "Set1") + ggtitle("Datos con/sin region por marcadores Fungi")  + theme(axis.text.x = element_text(angle = 90, hjust = 1))

```


GENBANK plots
latlon
```{r, echo=F, warning=F, message=F}
f_latlon_plot
p_latlon_plot1
p_latlon_plot2
p_latlon_plot3
p_latlon_plot4
m_latlon_plot
```

estado
```{r, echo=F, warning=F, message=F}
f_estado_plot
p_estado_plot1
p_estado_plot2
p_estado_plot3
p_estado_plot4
m_estado_plot
```

```{r, echo=F, warning=F, message=F}
f_region_plot
p_region_plot1
p_region_plot2
p_region_plot3
p_region_plot4
m_region_plot

```


###Información geográfica disponible para las entradas que no tienen latitud-longitud
```{r, echo=F, warning=F, message=F}

```


Dar el formato adecuado a las gráficas para geógrafos :

```{r, echo=F, warning=F, message=F}

genbank_geo<-genbank[c(1,12:14, 28:30)]
genbank_geo[which(is.na(genbank$estado)&(!(is.na(genbank$estado_region)))),7]<-genbank_geo[which(is.na(genbank$estado)&(!(is.na(genbank$estado_region)))),5]


```

```{r, echo=F, warning=F, message=F}
genbank_geo<-genbank_geo %>% mutate(lat=sub('[N|S] [[:digit:]]+.*[[:digit:]]* [E|W]', '' ,genbank_geo$`lat-lon`),
                  lon=sub('[[:digit:]]+.*[[:digit:]]* [N|S]', '' ,genbank_geo$`lat-lon`),
                  region=sub('^, ', '', genbank_geo$region)) 
genbank_geo<-genbank_geo%>%mutate(lat=sub('-', '0', lat), lon=sub('-','0', lon))

genbank_geo<-genbank_geo%>%mutate(lon=as.numeric(sub('[E|W]', '', lon)), lat=as.numeric(lat))

genbank_geo[ grep(' S ', genbank_geo$`lat-lon`) , 8]<-genbank_geo[ grep(' S ', genbank_geo$`lat-lon`) , 8] *-1
genbank_geo[ grep(' W', genbank_geo$`lat-lon`) , 9]<-genbank_geo[ grep(' W', genbank_geo$`lat-lon`) , 9] *-1

write_tsv(genbank_geo, "GENBANK_GEO.tsv")
```


